<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Diálogo Diário de Segurança</title>
<style>
  :root{ --accent:#0b6fb6; --muted:#666; --bg:#f8f9fb; }
  *{box-sizing:border-box}
  body{ font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; margin:0; background:var(--bg); color:#222; }
  .wrap{ max-width:900px;margin:18px auto;padding:18px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(10,20,40,0.06);}
  header{text-align:center;margin-bottom:14px}
  .logo{ max-height:72px;display:block;margin:0 auto 8px; }
  h1{margin:6px 0 18px;font-size:28px}
  form{display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:end;margin-bottom:14px}
  label{font-weight:600;font-size:14px;color:var(--muted)}
  input[type="text"], select, input[type="password"]{ padding:8px 10px;border:1px solid #ddd;border-radius:6px;width:100%;background:#fff;}
  .full { grid-column: 1 / -1; }
  .carinhas{display:flex;gap:18px;align-items:center}
  .emoji-label{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:1px solid transparent;cursor:pointer;user-select:none;font-size:20px;background:transparent;}
  .emoji-label input{margin-right:6px}
  .emoji-label.selected{background:rgba(11,111,182,0.08);border-color:rgba(11,111,182,0.25)}
  button{ background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600; }
  button.ghost{background:transparent;color:var(--accent);border:1px solid var(--accent)}
  .msg{margin:8px 0;color:green;font-weight:600}
  table{width:100%;border-collapse:collapse;margin-top:6px}
  th,td{border:1px solid #eee;padding:10px;text-align:center}
  th{background:#fafafa}
  tr:nth-child(even){background:#fcfcfe}
  .admin-bar{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:12px;flex-wrap:wrap}
  .small{padding:8px 10px;border-radius:8px}
  .danger{background:#e04b4b}
  .hidden{display:none}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="Logo/0.png" alt="Logo" class="logo" onerror="this.style.display='none'">
      <h1>Diálogo Diário de Segurança</h1>
    </header>

    <form id="formHumor" autocomplete="off">
      <div>
        <label for="nome">Nome:</label>
        <input id="nome" type="text" placeholder="Seu nome" required>
      </div>

      <div>
        <label for="local">Local de trabalho:</label>
        <select id="local" required>
          <option value="">Selecione...</option>
          <option>Itabira</option>
          <option>Usiminas - Ipatinga</option>
          <option>Usiminas - Cubatão</option>
          <option>Outros</option>
        </select>
      </div>

      <div class="full">
        <label>Como está o humor hoje?</label>
        <div class="carinhas">
          <label class="emoji-label"><input type="radio" name="humor" value="😊" required> <span style="font-size:26px">😊</span> Bom</label>
          <label class="emoji-label"><input type="radio" name="humor" value="😞"> <span style="font-size:26px">😞</span> Triste</label>
        </div>
      </div>

      <div class="full" style="display:flex;gap:10px">
        <button id="btnSalvar" type="submit">Salvar</button>
        <div style="flex:1"></div>
        <div id="msg" class="msg" aria-live="polite"></div>
      </div>
    </form>

    <h2>Registros</h2>
    <table id="tabela" aria-live="polite">
      <thead>
        <tr><th>Nome</th><th>Local</th><th>Humor</th><th>Data</th><th class="admin-only hidden">Ações</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="admin-area">
      <div style="margin-top:10px">
        <input id="senhaAdmin" type="password" placeholder="Senha admin" />
        <button id="btnLoginAdmin" class="small ghost" type="button">Entrar como Admin</button>
        <button id="btnLogoutAdmin" class="small hidden" type="button">Sair Admin</button>
      </div>
      <div class="admin-bar">
        <!-- Filtro de Local -->
        <select id="filtroLocal" class="hidden">
          <option value="Todos">Todos os locais</option>
          <option value="Itabira">Itabira</option>
          <option value="Usiminas - Ipatinga">Usiminas - Ipatinga</option>
          <option value="Usiminas - Cubatão">Usiminas - Cubatão</option>
          <option value="Outros">Outros</option>
        </select>

        <button id="btnImprimir" class="small hidden" type="button">Imprimir Relatório</button>
        <button id="btnExport" class="small hidden" type="button">Exportar CSV</button>
        <button id="btnClear" class="small danger hidden" type="button">Apagar todos</button>
      </div>
    </div>
  </div>

<script>
(function(){
  const STORAGE_KEY = 'humor_registros_v1';
  const ADMIN_PASS = '1234'; 

  const form = document.getElementById('formHumor');
  const tabelaBody = document.querySelector('#tabela tbody');
  const msg = document.getElementById('msg');
  const senhaInput = document.getElementById('senhaAdmin');
  const btnLoginAdmin = document.getElementById('btnLoginAdmin');
  const btnLogoutAdmin = document.getElementById('btnLogoutAdmin');
  const btnImprimir = document.getElementById('btnImprimir');
  const btnExport = document.getElementById('btnExport');
  const btnClear = document.getElementById('btnClear');
  const filtroLocal = document.getElementById('filtroLocal');
  const adminColumns = document.querySelectorAll('.admin-only');

  let registros = [];

  function loadRecords(){
    try{ registros = JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
    catch(e){ registros = []; }
  }

  function saveRecords(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(registros)); }

  function showMessage(text, isError=false){
    msg.textContent = text;
    msg.style.color = isError? '#b00020' : 'green';
    setTimeout(()=> { if (msg.textContent === text) msg.textContent = ''; }, 2500);
  }

  function formatDate(iso){ try{ return new Date(iso).toLocaleString('pt-BR'); }catch(e){ return iso||'';} }

  function renderTable(){
    tabelaBody.innerHTML = '';
    registros.forEach((r, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r.nome||''}</td>
        <td>${r.local||''}</td>
        <td>${r.humor||''}</td>
        <td>${formatDate(r.criadoEm||'')}</td>
        <td class="admin-only ${isAdmin()?'':'hidden'}">
          ${isAdmin()?'<button class="small danger">Apagar</button>':''}
        </td>`;
      if (isAdmin()){
        tr.querySelector('button').onclick = ()=> {
          if (confirm('Apagar este registro?')){
            registros.splice(idx,1); saveRecords(); renderTable(); showMessage('Registro apagado');
          }
        };
      }
      tabelaBody.appendChild(tr);
    });
  }

  function isAdmin(){ return sessionStorage.getItem('isAdmin') === '1'; }

  form.addEventListener('submit', e=>{
    e.preventDefault();
    const nome = document.getElementById('nome').value.trim();
    const local = document.getElementById('local').value;
    const humorEl = document.querySelector('input[name="humor"]:checked');
    if (!nome || !local || !humorEl){ showMessage('Preencha todos os campos.', true); return; }
    registros.push({nome, local, humor: humorEl.value, criadoEm:new Date().toISOString()});
    saveRecords(); renderTable(); showMessage('Registro salvo com sucesso.');
    form.reset(); document.querySelectorAll('.emoji-label').forEach(l=>l.classList.remove('selected'));
  });

  btnLoginAdmin.onclick = ()=>{
    if (senhaInput.value === ADMIN_PASS){
      sessionStorage.setItem('isAdmin','1');
      applyAdminUI(true); showMessage('Modo administrador ativado.'); senhaInput.value='';
    } else showMessage('Senha incorreta.', true);
  };

  btnLogoutAdmin.onclick = ()=>{ sessionStorage.removeItem('isAdmin'); applyAdminUI(false); showMessage('Deslogado do modo administrador.'); };

  function applyAdminUI(isOn){
    [btnImprimir,btnExport,btnClear,btnLogoutAdmin,filtroLocal].forEach(el=> el.classList[isOn?'remove':'add']('hidden'));
    [btnLoginAdmin,senhaInput].forEach(el=> el.classList[isOn?'add':'remove']('hidden'));
    renderTable();
  }

  // Impressão com filtro
  btnImprimir.onclick = ()=>{
    const filtro = filtroLocal.value;
    const lista = filtro==='Todos' ? registros : registros.filter(r=>r.local===filtro);
    if (!lista.length){ showMessage('Nenhum registro para este local.', true); return; }
    const newWin = window.open('', '_blank', 'width=900,height=700');
    let rows = lista.map(r=>`<tr><td>${r.nome}</td><td>${r.local}</td><td>${r.humor}</td><td>${formatDate(r.criadoEm)}</td></tr>`).join('');
    newWin.document.write(`
      <html><head><title>Relatório</title></head><body>
      <h2 style="text-align:center">Relatório de Humor - ${filtro}</h2>
      <table border="1" style="width:100%;border-collapse:collapse;text-align:center">
        <tr><th>Nome</th><th>Local</th><th>Humor</th><th>Data</th></tr>
        ${rows}
      </table>
      </body></html>
    `);
    newWin.document.close(); newWin.print();
  };

  loadRecords(); renderTable(); applyAdminUI(isAdmin());
})();
</script>
</body>
</html>
